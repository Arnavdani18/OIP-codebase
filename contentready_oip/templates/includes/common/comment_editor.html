<div class="shadow editor-container">
    <div class="commentSection">
        <div class="created-by mt-5">
            {% set doc_owner = user %}
            {% include "templates/includes/common/user_thumbnail.html" %}
        </div>
        <div class="input-group">
            <div class="input-group-prepend">
                <!-- <button class="btn btn-outline-secondary" type="button"><i class="fas fa-paperclip"></button> -->
            </div>
            <!-- TODO: onblur="contractCommentArea(event.target.id)" -->
            <textarea class="form-control" id="comment-area-{{doctype}}-{{name}}" placeholder="Add a comment..."
                rows="1" onfocus="expandCommentArea(event.target.id)"></textarea>
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" onclick="cancelComment('comment-area-{{doctype}}-{{name}}', '{{parent_div}}')">Cancel</button>
                <button class="btn btn-outline-secondary" type="button" onclick="submitComment('{{doctype}}', '{{name}}')">Submit</button>
            </div>
        </div>
    </div>
</div>
<script>
    expandCommentArea = (id) => {
        // set rows=5
        $(`#${id}`).attr('rows', '5');
    }

    contractCommentArea = (id) => {
        // set rows=1
        $(`#${id}`).attr('rows', '1');
    }

    cancelComment = (id, parent_div) => {
        $(`#${id}`).val('');
        contractCommentArea(id);
        if (parent_div) {
            $(parent_div).addClass('hidden');
        }
    }

    submitComment = (doctype, name) => {
        const id = `comment-area-${doctype}-${name}`; // for compatibility with cancelComment
        const text = $(`#${id}`).val();
        if (text.length) {
            // console.log(comment);
            frappe.call({
                method: 'contentready_oip.api.add_comment',
                args: {doctype: doctype, name: name, text: text},
                callback: (r) => {
                    // console.log(r);
                    if (doctype == 'Discussion') {
                        window.location.reload();
                    } else if (r.message){
                        $('#discussionTabGroup').prepend(r.message);
                        cancelComment(id);
                    }
                }
            });
        } else {
            frappe.throw('Cannot submit an empty comment.');
        }
    }
</script>